!function(a,b,c){"use strict";function d(){this._itemHash={},this._itemList=[]}function e(e,g){var i;this.options=a.extend({},h,g),this.$list=a(e),this.$container=this.options.scrollContainer instanceof a?this.options.scrollContainer:a(this.options.scrollContainer),this.container=this.$container[0],this.$front=a("<"+this.options.itemElementType+' id="inf-front-spacer" />'),this.$rear=a("<"+this.options.itemElementType+' id="inf-rear-spacer" />'),i=c.documentElement.clientHeight,this._containerIsWindow=this.container===b,this._clientHeight=this._containerIsWindow?i:Math.min(this.container.clientHeight,i),this.options.topGutter+=this.$list[0].offsetTop,this._rearHeight=0,this._frontHeight=0,this._prevScrollTop=this._scrollTop,this._lastReadScrollTop=this._prevScrollTop,this._visibleItems=new d,this._itemList=new d,this.ListItem=Object.create(f,{options:{value:this.options},_clientHeight:{value:this._clientHeight}}),this.init()}var f,g="infiniteList",h={topGutter:300,bottomGutter:300,itemClass:"",itemElementType:"div",scrollContainer:b};f={init:function(b,c,d){this.el=b,this.$el=a(b),this.id=b.id,this.top=d||b.offsetTop,this.height=b.offsetHeight,this.bottom=this.top+this.height,this.index=c},inView:function(a){return!this.beforeView(a)&&!this.afterView(a)},afterView:function(a){return this.top>a+this._clientHeight+this.options.bottomGutter},beforeView:function(a){return this.bottom<(0!==a?a-this.options.topGutter:0)}},d.prototype={contains:function(a){return!!this._itemHash[a.id]},elementAt:function(a){return this._itemList[a]},empty:function(){this._itemHash={},this._itemList.length=0},forEach:function(a,b){return this._itemList.forEach(a,b)},get:function(a){return this._itemHash[a]},last:function(){return this._itemList[this._itemList.length-1]},length:function(){return this._itemList.length},push:function(a){this._itemList.push(a),this._itemHash[a.id]=a},reHash:function(a,b){var c=this._itemHash[a];c.id=b,delete this._itemHash[a],this._itemHash[b]=c},remove:function(a){this.contains(a)&&(this._itemList.splice(this._itemList.indexOf(a),1),delete this._itemHash[a.id])},toArray:function(a,b){return this._itemList.slice(a,b)},unshift:function(a){this._itemList.unshift(a),this._itemHash[a.id]=a},insert:function(a){var b,c=arguments;b=Array.isArray(c[1])?c[1]:Array.prototype.slice.call(c,1),0===a?Array.prototype.unshift.apply(this._itemList,b):a===this.length()-1?Array.prototype.push.apply(this._itemList,b):Array.prototype.splice.apply(this._itemList,[a,0].concat(b)),b.forEach(function(a){this._itemHash[a.id]=a},this)}},e.prototype={init:function(){var b;b=a("<"+this.options.itemElementType+' class="'+this.options.itemClass+'" />').appendTo(this.$list),this.ListItem.marginTop=parseInt(b.css("margin-top"),10),this.ListItem.marginBottom=parseInt(b.css("margin-bottom"),10),b.remove(),this.$list[0].children.length&&this.append(Array.prototype.slice.call(this.$list[0].children)),this.$rear.css("margin-bottom",this.ListItem.marginBottom),this.$list.prepend(this.$front).append(this.$rear),this.$container.on("scroll."+g,function(){!this._rafing&&this._itemList.length()&&(this._lastReadScrollTop=this._scrollTop,requestAnimationFrame(this._scroll.bind(this)),this._rafing=!0)}.bind(this))},append:function(b){var c,d,e,f,g=!1,h=[],i=this._itemList.last()||{};c=this._parseArgument(b),e=this._itemList.length()-1,f=this._scrollTop,this.$rear.before(c),this.$list.trigger("beforeadd.infinitelist",[a(c)]),c.forEach(function(a,b){d=Object.create(this.ListItem),d.init(a,b+e+1,i.bottom+this.ListItem.marginBottom),this._itemList.push(d),g||d.afterView(f)?(h.push(d.el),g=!0):this._visibleItems.push(d),i=d},this),a(h).detach(),this._rearHeight=this._itemList.last().bottom-this._visibleItems.last().bottom,this.$rear[0].style.height=this._rearHeight+"px"},prepend:function(b){var c,d,e=[],f=this._scrollTop,g=this._parseArgument(b),h=this._itemList.elementAt(0);this.$list.prepend(g),this.$list.trigger("beforeadd.infinitelist",[a(g)]),g.forEach(function(a,b){c=Object.create(this.ListItem),c.init(a,b,d?d.bottom+this.ListItem.marginBottom:0),e.push(c),d=c},this),a(g).detach(),this._itemList.insert(0,e),this._reCalcPositions(g.length),this._reIndexItems(0),this._visibleItems.length()&&(this._frontHeight=this._visibleItems.elementAt(0).top,this.$front[0].style.height=this._frontHeight+"px",this._scrollTop=this._visibleItems.elementAt(0)!==h?f+c.bottom+this.ListItem.marginBottom:f,this._prevScrollTop=this._scrollTop),this._prevScrollTop++,this._scroll()},children:function(){var b=[];return this._itemList.forEach(function(a){b.push(a.el)}),a(b)},destroy:function(){this.$list.html(this.children()).removeData("plugin_"+g).off("."+g)},find:function(b){var c=[];return this._itemList.forEach(function(a){Array.prototype.push.apply(c,a.$el.find(b).addBack(b))}),a(c)},last:function(){var b=this._itemList.last();return b?b.$el:a()},visible:function(){var b=[];return this._visibleItems.forEach(function(a){b.push(a.el)}),a(b)},removeItem:function(b){var c=b instanceof a?b[0]:b,d=this._itemList.get(c.id);this._itemList.remove(d),this._visibleItems.remove(d),d.$el.remove(),this._reCalcPositions(d.index),this._reIndexItems(d.index),this._itemList.length()&&this._scroll(this._scrollTop)},replaceId:function(a,b){var c=this._itemList.get(a);c.el.id=b,this._visibleItems.contains(c)&&this._visibleItems.reHash(a,b),this._itemList.reHash(a,b)},replaceItem:function(b,c,d){var e=this._itemList.get(b),f=a(c);e.$el.replaceWith(f),e.$el=f,e.el=e.$el[0],this.replaceId(b,e.el.id),d||this.resizeItems(e.$el)},refresh:function(){},reset:function(){this._itemList.empty(),this._visibleItems.empty(),this._frontHeight=0,this._rearHeight=0,this.$list.empty().prepend(this.$front).append(this.$rear),this.$rear[0].style.height="",this.$front[0].style.height="",this._prevScrollTop=this._scrollTop,this._lastReadScrollTop=this._prevScrollTop},resizeItems:function(b){var c,d,e=b instanceof a?b.get():b,f=[],g=this._itemList.length()-1;e.forEach(function(a){c=this._itemList.get(a.id),g=Math.min(g,c.index),this._visibleItems.contains(c)||f.push(a)},this),d=a(f).appendTo(this.$list),this.$list.trigger("beforeresize.infinitelist"),e.forEach(function(a){c=this._itemList.get(a.id),c.height=a.offsetHeight},this),d.detach(),this._reCalcPositions(g),this._scroll(this._scrollTop)},length:function(){return this._itemList.length()},_reCalcPositions:function(a){var b=this._itemList.toArray(a),c=this._itemList.elementAt(a-1);b.forEach(function(a){a.top=c?c.bottom+this.ListItem.marginBottom:0,a.bottom=a.height+a.top,c=a},this)},_reIndexItems:function(a){var b=0,c=this._itemList.length();for(b=a;c>b;b++)this._itemList.elementAt(b).index=b},_scroll:function(){var a,b,c,d,e,f=this._lastReadScrollTop,g=this._prevScrollTop<=f,h=!1,i=!1;if(this._visibleItems.length()?g?(b=this._visibleItems.elementAt(0).index,c=this._itemList.length()):(b=0,c=this._visibleItems.last().index+1):(b=0,c=this._itemList.length()),a=this._itemList.toArray(b,c),g)for(d=0;d<a.length&&!h;d++)e=a[d],this._visibleItems.contains(e)?e.beforeView(f)&&(e.$el.detach(),this._visibleItems.remove(e),i=!0):e.inView(f)?(this.$rear.before(e.el),this._visibleItems.push(e),i=!0):e.afterView(f)&&(h=!0);else for(d=a.length-1;d>=0&&!h;d--)e=a[d],this._visibleItems.contains(e)?e.afterView(f)&&(e.$el.detach(),this._visibleItems.remove(e),i=!0):e.inView(f)?(this.$front.after(e.el),this._visibleItems.unshift(e),i=!0):e.beforeView(f)&&(h=!0);this._frontHeight=this._visibleItems.elementAt(0).top,this._rearHeight=Math.max(this._itemList.last().bottom-this._visibleItems.last().bottom-this.ListItem.marginBottom,0),i&&(this.$front[0].style.height=this._frontHeight+"px",this.$rear[0].style.height=this._rearHeight+"px"),this._prevScrollTop=f,this._rafing=!1},get _scrollTop(){return this._containerIsWindow?this.container.pageYOffset:this.container.scrollTop},set _scrollTop(a){this._containerIsWindow?b.scroll(0,a):this.container.scrollTop=a,this._lastReadScrollTop=a},_parseArgument:function(b){var c=[];return"string"==typeof b?c=a("<span>"+b+"</span>").find("."+this.options.itemClass.split(" ")[0]).get():Array.isArray(b)?c=b:b instanceof a&&(c=b.get()),c}},a.fn[g]=function(b){var c,d=arguments;return this.each(function(){var f=a.data(this,"plugin_"+g);if(f){if("string"==typeof b&&"_"!==b[0]&&a.isFunction(f[b])&&(c=f[b].apply(f,Array.prototype.slice.call(d,1)),void 0!==c))return!1}else a.data(this,"plugin_"+g,new e(this,b))}),void 0!==c?c:this},a.fn[g].HashList=d}(jQuery,window,document);